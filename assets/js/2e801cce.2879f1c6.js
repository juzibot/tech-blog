"use strict";(self.webpackChunktech_blog=self.webpackChunktech_blog||[]).push([[450],{6029:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"wecom-openapi","metadata":{"permalink":"/wecom-openapi","editUrl":"https://github.com/juzibot/tech-blog/blog/2022-02-18-wecom-openapi.mdx","source":"@site/blog/2022-02-18-wecom-openapi.mdx","title":"WeCom x Swagger","description":"During the process integration with WeCom, we found that there are too many WeCom APIs needs to be integrated, and they all require different parameters. To reduce repeated work and human mistakes, we decide to use some tools generate WeCom API client code automatically.","date":"2022-02-18T00:00:00.000Z","formattedDate":"February 18, 2022","tags":[{"label":"swagger","permalink":"/tags/swagger"},{"label":"openapi","permalink":"/tags/openapi"},{"label":"wecom","permalink":"/tags/wecom"},{"label":"codegen","permalink":"/tags/codegen"}],"readingTime":2.885,"truncated":true,"authors":[{"name":"Guili Liu","title":"Senior Engineer of Juzi Bot","url":"https://github.com/gongzili456","imageURL":"https://avatars.githubusercontent.com/u/6082335","key":"rory"}],"frontMatter":{"slug":"wecom-openapi","title":"WeCom x Swagger","authors":"rory","tags":["swagger","openapi","wecom","codegen"],"keywords":["swagger","openapi","wecom","wxwork","workweixin","workwx","qychat","qywork","openapi3","codegen","wework","wecaht"]},"nextItem":{"title":"Juzi Bot Tech Blog is Live!","permalink":"/first-blog"}},"content":"import Image from \'@theme/IdealImage\';\\nimport swaggerBanner from \'/img/2022-02-18-wecom-gateway/swagger_banner.jpeg\';\\nimport authorizeStep from \'/img/2022-02-18-wecom-gateway/authorize_step.png\';\\nimport proxyStep from \'/img/2022-02-18-wecom-gateway/proxy_step.png\';\\n\\nDuring the process integration with WeCom, we found that there are too many WeCom APIs needs to be integrated, and they all require different parameters. To reduce repeated work and human mistakes, we decide to use some tools generate WeCom API client code automatically.\\n\\nThen we found the `Swagger`, after some trial and error, we got such a convenient tool...\\n\\n\x3c!--truncate--\x3e\\n\\nGithub: [github.com/juzibot/wecom-openapi](https://github.com/juzibot/wecom-openapi)\\n\\nDemo: [wecom-openapi.juzibot.com](https://wecom-openapi.juzibot.com)\\n\\n## OpenAPI Standard\\n\\nOpen API Standard (OAS) defines a standard, language irrelevant RESTful API standard. It enables developers and machines check and understand features of a specific service without accessing the source code, document or network traffic check. It is easy to read for not only human, but also machines. With a correctly defined OAS, developers could use least amount of work integrating services.\\n\\nBesides, document generation tools could take advantage of OAS to generate API documents, code generation tools could automatically generate client, server code, and even test code. Refer to [OpenAPI Specification](https://swagger.io/specification/).\\n\\n<Image img={swaggerBanner} />\\n\\n## WeCom-OpenAPI\\n\\nWeCom does not provide documents that aligned with OAS, so we decide to create [WeCom-OpenAPI](https://github.com/juzibot/wecom-openapi).\\n\\n[WeCom-OpenAPI](https://github.com/juzibot/wecom-openapi) is a project take advantage of the integration of `NestJS` and `Swagger`, [@nestjs/swagger](https://www.npmjs.com/package/@nestjs/swagger) provides some decorators to declare Swagger attributes, make it very convenient to manage the relations between APIs.\\n\\n## How to use\\n\\nFirst of all, clone the project to your local environment, install dependencies and start the project. Then the project will automatically generate swagger spec file openapi.yaml inside the root folder. Meanwhile, you can open your browser visit http://localhost:3000/openapi to check Swagger UI.\\n\\n```bash\\n$ git clone git@github.com:juzibot/wecom-openapi.git\\n\\n$ cd wecom-opwenapi && npm install\\n\\n$ npm run start\\n```\\n[WeCom-OpenAPI](https://github.com/juzibot/wecom-openapi) provides WeCom API proxy, so when you are able to debug WeCom API on Swagger UI. Just input your AccessToken as show below.\\n\\n<Image img={authorizeStep} />\\n\\nThen select the local proxy endpoint to avoid cross origin issue.\\n\\n<Image img={proxyStep} />\\n\\n## Code generation\\n\\nThe common code generation tool is [swagger-codegen](https://github.com/swagger-api/swagger-codegen), but this project does not generate a developer friendly golang code, so we recommend to use [go-swagger](https://github.com/go-swagger/go-swagger) if you want to generate golang code. But this project only support Swagger 2.0, so we need to conver the version of the openapi.yaml file. Here we use [api-spec-converter](https://www.npmjs.com/package/api-spec-converter) to do the version conversion.\\n\\n```bash\\n$ npm install -g api-spec-converter\\n\\n# convert doc version\\n$ api-spec-converter --from=openapi_3 --to=swagger_2 \\\\\\n  --syntax=yaml \\\\\\n  --order=alpha \\\\\\n  ./openapi.yaml > swagger.yaml\\n \\n# install go-swaager \\n$ brew install go-swagger\\n \\n$ mkdir wecom-api\\n\\n# generate golang code, the target folder must be in GO_PATH\\n$ cd wecom-api && go mod init wecom-api\\n\\n# generate golang code\\n$ swagger generate client -f swagger.yaml -t wecom-api\\n```\\n\\nUtil here, we can see the generated code file inside `wecom-api` folder.\\n\\n```\\n./wecom-api/\\n\u251c\u2500\u2500 client\\n\u2514\u2500\u2500 models\\n```\\n- client folder: Client, Parameter and Response Object\\n- models folder: DTO, Response Entities definition\\n\\n## Example\\n\\n```go\\npackage main\\n\\nimport (\\n  \\"log\\"\\n  \\"wecom-api/client\\"\\n  \\"wecom-api/client/department\\"\\n\\n  \\"github.com/go-openapi/runtime\\"\\n  \\"github.com/go-openapi/strfmt\\"\\n)\\n\\n// define auth object\\ntype auth struct{}\\n\\nvar token = \\"token\\"\\n\\n// implement ClientAuthInfoWriter api\\nfunc (a *auth) AuthenticateRequest(req runtime.ClientRequest, reg strfmt.Registry) error {\\n  // put the token at the right place\\n  return req.SetQueryParam(\\"access_token\\", token)\\n}\\n\\nfunc main() {\\n  departmentID := float64(1)\\n  params := department.NewListDepartmentParams()\\n  params.SetID(&departmentID)\\n\\n  resp, err := client.Default.Department.ListDepartment(params, &auth{})\\n  if err != nil {\\n    log.Fatalf(\\"err: %v\\", err)\\n  }\\n\\n  log.Printf(\\"%v, %s\\", resp.Payload.Errcode, resp.Payload.Errmsg)\\n\\n  for _, v := range resp.Payload.Department {\\n    log.Printf(\\"%v\\", v)\\n  }\\n}\\n```"},{"id":"first-blog","metadata":{"permalink":"/first-blog","editUrl":"https://github.com/juzibot/tech-blog/blog/2022-02-11-first-blog.mdx","source":"@site/blog/2022-02-11-first-blog.mdx","title":"Juzi Bot Tech Blog is Live!","description":"We are Juzi Bot Tech Team, we use cutting-edge technologies to build Next Generation, IM based Marketing Cloud. We want to empower companies to achieve business leap with our product.","date":"2022-02-11T00:00:00.000Z","formattedDate":"February 11, 2022","tags":[{"label":"event","permalink":"/tags/event"}],"readingTime":0.73,"truncated":true,"authors":[{"name":"Yuan Gao","title":"CTO of Juzi Bot","url":"https://github.com/windmemory","imageURL":"https://github.com/windmemory.png","key":"windmemory"}],"frontMatter":{"slug":"first-blog","title":"Juzi Bot Tech Blog is Live!","authors":"windmemory","tags":["event"]},"prevItem":{"title":"WeCom x Swagger","permalink":"/wecom-openapi"}},"content":"import Image from \'@theme/IdealImage\';\\nimport thumbnail from \'/img/2022-02-11-first-blog/hr_qrcode.png\';\\nimport banner from \'/img/juzi-tech-team-banner.jpg\';\\n\\nWe are ***Juzi Bot Tech Team***, we use cutting-edge technologies to build ***Next Generation, IM based Marketing Cloud***. We want to empower companies to achieve business leap with our product.\\n\\nWe will share our tech insights along our development journey here. These insights will include not only experience of some specific technologies, frameworks or libraries, but also non-tech experiences.\\n\\n\x3c!--truncate--\x3e\\n\\n<Image img={banner} />\\n\\nWe believe that the value of techniques only shines when we **apply it to solve real problems**. So we are passionate about **thinking out of box**, using hacky way to solve weird problems, problems that are not common, but really matters to users.\\n\\n---\\n\\n# WE ARE HIRING\\nScan below QR Code to learn more about a great opportunity joining a tech driven company!\\n\\n<Image img={thumbnail} style={{ maxWidth: \'310px\' }} />"}]}')}}]);