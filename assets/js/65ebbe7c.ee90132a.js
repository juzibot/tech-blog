(self.webpackChunktech_blog=self.webpackChunktech_blog||[]).push([[659],{8268:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/authorize_step.433601d.640.png 640w,"+a.p+"assets/ideal-img/authorize_step.03ae9ff.770.png 770w,"+a.p+"assets/ideal-img/authorize_step.8f692d2.900.png 900w,"+a.p+"assets/ideal-img/authorize_step.999983f.1030.png 1030w",images:[{path:a.p+"assets/ideal-img/authorize_step.433601d.640.png",width:640,height:390},{path:a.p+"assets/ideal-img/authorize_step.03ae9ff.770.png",width:770,height:469},{path:a.p+"assets/ideal-img/authorize_step.8f692d2.900.png",width:900,height:548},{path:a.p+"assets/ideal-img/authorize_step.999983f.1030.png",width:1030,height:628}],src:a.p+"assets/ideal-img/authorize_step.433601d.640.png",toString:function(){return a.p+"assets/ideal-img/authorize_step.433601d.640.png"},placeholder:void 0,width:640,height:390},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxUlEQVQImUXMS0oDQRhF4dpKpYqIaDekux5/PQg4koTQ6kB0GlcnLsA9KI5Mj12DCBIU5EgawcE3OVyuMtag9Qw901hrJ3NraYzmyBjMX1M5ZZIkaq3/SuGsZFYlsayFUitq4XsWrsfHSJADIZaCF2EZHDn6qavWC/OThuubW56eXxh3O97GVx4f7ikh0PtIFEF1IXF82rDd3rH//uHz4x2+9ozjiJeECxE5DFvvaLuOXCub4YLVMLC5vOJ8vcbFiIthevwFeAxxhna8tG4AAAAASUVORK5CYII=",palette:null}},6342:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/proxy_step.f07be93.640.png 640w,"+a.p+"assets/ideal-img/proxy_step.37f26e1.770.png 770w,"+a.p+"assets/ideal-img/proxy_step.78699f7.900.png 900w,"+a.p+"assets/ideal-img/proxy_step.056fd06.1030.png 1030w",images:[{path:a.p+"assets/ideal-img/proxy_step.f07be93.640.png",width:640,height:340},{path:a.p+"assets/ideal-img/proxy_step.37f26e1.770.png",width:770,height:409},{path:a.p+"assets/ideal-img/proxy_step.78699f7.900.png",width:900,height:479},{path:a.p+"assets/ideal-img/proxy_step.056fd06.1030.png",width:1030,height:548}],src:a.p+"assets/ideal-img/proxy_step.f07be93.640.png",toString:function(){return a.p+"assets/ideal-img/proxy_step.f07be93.640.png"},placeholder:void 0,width:640,height:340},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmUlEQVQImWWMPQuCUABF/dG9ksZw7Hc0BQ0NBVEOLRFme+TmN0aI5jN9ekKtqQv3LudwNTESjCeC2XyKYRjouo4Q4q8a3/h+gutHBFGCF8REcUJeez+MJqWk7ysjT58UWQqq5F2WFEUxMCmHx6qqWZs2y53Fam+z2Jxxw0f/1DQNbduiddOJx6vDwbpjXhy2pxthkvaiUqqXP/ycrr5S9rLbAAAAAElFTkSuQmCC",palette:null}},1941:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg 640w,"+a.p+"assets/ideal-img/swagger_banner.d480f49.770.jpeg 770w,"+a.p+"assets/ideal-img/swagger_banner.2a80460.900.jpeg 900w,"+a.p+"assets/ideal-img/swagger_banner.85f7c36.1030.jpeg 1030w",images:[{path:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg",width:640,height:285},{path:a.p+"assets/ideal-img/swagger_banner.d480f49.770.jpeg",width:770,height:343},{path:a.p+"assets/ideal-img/swagger_banner.2a80460.900.jpeg",width:900,height:401},{path:a.p+"assets/ideal-img/swagger_banner.85f7c36.1030.jpeg",width:1030,height:458}],src:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg",toString:function(){return a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg"},placeholder:void 0,width:640,height:285},preSrc:"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAFAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQH/8QAHhAAAQUAAgMAAAAAAAAAAAAAAwABAhESEyEiUaH/xAAVAQEBAAAAAAAAAAAAAAAAAAADBP/EABgRAAIDAAAAAAAAAAAAAAAAAAACAREh/9oADAMBAAIRAxEAPwDbSgKIhSwM0Rcb+DR71d61fylYAc+EeiylLLW/vpEUjTY64f/Z",palette:null}},3928:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return h},contentTitle:function(){return A},metadata:function(){return u},assets:function(){return w},toc:function(){return f},default:function(){return b}});var n=a(7462),o=a(3366),i=(a(7294),a(4137)),r=a(5944),s=a(1941),p=a.n(s),g=a(8268),l=a.n(g),c=a(6342),d=a.n(c),m=["components"],h={slug:"wecom-openapi",title:"WeCom x Swagger",authors:"rory",tags:["swagger","openapi","wecom","codegen"],keywords:["swagger","openapi","wecom","wxwork","workweixin","workwx","qychat","qywork","openapi3","codegen","wework","wecaht"]},A=void 0,u={permalink:"/wecom-openapi",editUrl:"https://github.com/juzibot/tech-blog/blog/2022-02-18-wecom-openapi.mdx",source:"@site/blog/2022-02-18-wecom-openapi.mdx",title:"WeCom x Swagger",description:"During the process integration with WeCom, we found that there are too many WeCom APIs needs to be integrated, and they all require different parameters. To reduce repeated work and human mistakes, we decide to use some tools generate WeCom API client code automatically.",date:"2022-02-18T00:00:00.000Z",formattedDate:"February 18, 2022",tags:[{label:"swagger",permalink:"/tags/swagger"},{label:"openapi",permalink:"/tags/openapi"},{label:"wecom",permalink:"/tags/wecom"},{label:"codegen",permalink:"/tags/codegen"}],readingTime:2.885,truncated:!0,authors:[{name:"Guili Liu",title:"Senior Engineer of Juzi Bot",url:"https://github.com/gongzili456",imageURL:"https://avatars.githubusercontent.com/u/6082335",key:"rory"}],frontMatter:{slug:"wecom-openapi",title:"WeCom x Swagger",authors:"rory",tags:["swagger","openapi","wecom","codegen"],keywords:["swagger","openapi","wecom","wxwork","workweixin","workwx","qychat","qywork","openapi3","codegen","wework","wecaht"]},nextItem:{title:"Juzi Bot Tech Blog is Live!",permalink:"/first-blog"}},w={authorsImageUrls:[void 0]},f=[{value:"OpenAPI Standard",id:"openapi-standard",level:2},{value:"WeCom-OpenAPI",id:"wecom-openapi",level:2},{value:"How to use",id:"how-to-use",level:2},{value:"Code generation",id:"code-generation",level:2},{value:"Example",id:"example",level:2}],k={toc:f};function b(e){var t=e.components,a=(0,o.Z)(e,m);return(0,i.kt)("wrapper",(0,n.Z)({},k,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"During the process integration with WeCom, we found that there are too many WeCom APIs needs to be integrated, and they all require different parameters. To reduce repeated work and human mistakes, we decide to use some tools generate WeCom API client code automatically."),(0,i.kt)("p",null,"Then we found the ",(0,i.kt)("inlineCode",{parentName:"p"},"Swagger"),", after some trial and error, we got such a convenient tool..."),(0,i.kt)("p",null,"Github: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"github.com/juzibot/wecom-openapi")),(0,i.kt)("p",null,"Demo: ",(0,i.kt)("a",{parentName:"p",href:"https://wecom-openapi.juzibot.com"},"wecom-openapi.juzibot.com")),(0,i.kt)("h2",{id:"openapi-standard"},"OpenAPI Standard"),(0,i.kt)("p",null,"Open API Standard (OAS) defines a standard, language irrelevant RESTful API standard. It enables developers and machines check and understand features of a specific service without accessing the source code, document or network traffic check. It is easy to read for not only human, but also machines. With a correctly defined OAS, developers could use least amount of work integrating services."),(0,i.kt)("p",null,"Besides, document generation tools could take advantage of OAS to generate API documents, code generation tools could automatically generate client, server code, and even test code. Refer to ",(0,i.kt)("a",{parentName:"p",href:"https://swagger.io/specification/"},"OpenAPI Specification"),"."),(0,i.kt)(r.Z,{img:p(),mdxType:"Image"}),(0,i.kt)("h2",{id:"wecom-openapi"},"WeCom-OpenAPI"),(0,i.kt)("p",null,"WeCom does not provide documents that aligned with OAS, so we decide to create ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI"),"."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI")," is a project take advantage of the integration of ",(0,i.kt)("inlineCode",{parentName:"p"},"NestJS")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Swagger"),", ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@nestjs/swagger"},"@nestjs/swagger")," provides some decorators to declare Swagger attributes, make it very convenient to manage the relations between APIs."),(0,i.kt)("h2",{id:"how-to-use"},"How to use"),(0,i.kt)("p",null,"First of all, clone the project to your local environment, install dependencies and start the project. Then the project will automatically generate swagger spec file openapi.yaml inside the root folder. Meanwhile, you can open your browser visit http://localhost:3000/openapi to check Swagger UI."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone git@github.com:juzibot/wecom-openapi.git\n\n$ cd wecom-opwenapi && npm install\n\n$ npm run start\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI")," provides WeCom API proxy, so when you are able to debug WeCom API on Swagger UI. Just input your AccessToken as show below."),(0,i.kt)(r.Z,{img:l(),mdxType:"Image"}),(0,i.kt)("p",null,"Then select the local proxy endpoint to avoid cross origin issue."),(0,i.kt)(r.Z,{img:d(),mdxType:"Image"}),(0,i.kt)("h2",{id:"code-generation"},"Code generation"),(0,i.kt)("p",null,"The common code generation tool is ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/swagger-api/swagger-codegen"},"swagger-codegen"),", but this project does not generate a developer friendly golang code, so we recommend to use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/go-swagger/go-swagger"},"go-swagger")," if you want to generate golang code. But this project only support Swagger 2.0, so we need to conver the version of the openapi.yaml file. Here we use ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/api-spec-converter"},"api-spec-converter")," to do the version conversion."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm install -g api-spec-converter\n\n# convert doc version\n$ api-spec-converter --from=openapi_3 --to=swagger_2 \\\n  --syntax=yaml \\\n  --order=alpha \\\n  ./openapi.yaml > swagger.yaml\n \n# install go-swaager \n$ brew install go-swagger\n \n$ mkdir wecom-api\n\n# generate golang code, the target folder must be in GO_PATH\n$ cd wecom-api && go mod init wecom-api\n\n# generate golang code\n$ swagger generate client -f swagger.yaml -t wecom-api\n")),(0,i.kt)("p",null,"Util here, we can see the generated code file inside ",(0,i.kt)("inlineCode",{parentName:"p"},"wecom-api")," folder."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./wecom-api/\n\u251c\u2500\u2500 client\n\u2514\u2500\u2500 models\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"client folder: Client, Parameter and Response Object"),(0,i.kt)("li",{parentName:"ul"},"models folder: DTO, Response Entities definition")),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n  "log"\n  "wecom-api/client"\n  "wecom-api/client/department"\n\n  "github.com/go-openapi/runtime"\n  "github.com/go-openapi/strfmt"\n)\n\n// define auth object\ntype auth struct{}\n\nvar token = "token"\n\n// implement ClientAuthInfoWriter api\nfunc (a *auth) AuthenticateRequest(req runtime.ClientRequest, reg strfmt.Registry) error {\n  // put the token at the right place\n  return req.SetQueryParam("access_token", token)\n}\n\nfunc main() {\n  departmentID := float64(1)\n  params := department.NewListDepartmentParams()\n  params.SetID(&departmentID)\n\n  resp, err := client.Default.Department.ListDepartment(params, &auth{})\n  if err != nil {\n    log.Fatalf("err: %v", err)\n  }\n\n  log.Printf("%v, %s", resp.Payload.Errcode, resp.Payload.Errmsg)\n\n  for _, v := range resp.Payload.Department {\n    log.Printf("%v", v)\n  }\n}\n')))}b.isMDXComponent=!0}}]);