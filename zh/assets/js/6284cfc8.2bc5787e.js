(self.webpackChunktech_blog=self.webpackChunktech_blog||[]).push([[6924],{8268:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/authorize_step.433601d.640.png 640w,"+a.p+"assets/ideal-img/authorize_step.03ae9ff.770.png 770w,"+a.p+"assets/ideal-img/authorize_step.8f692d2.900.png 900w,"+a.p+"assets/ideal-img/authorize_step.999983f.1030.png 1030w",images:[{path:a.p+"assets/ideal-img/authorize_step.433601d.640.png",width:640,height:390},{path:a.p+"assets/ideal-img/authorize_step.03ae9ff.770.png",width:770,height:469},{path:a.p+"assets/ideal-img/authorize_step.8f692d2.900.png",width:900,height:548},{path:a.p+"assets/ideal-img/authorize_step.999983f.1030.png",width:1030,height:628}],src:a.p+"assets/ideal-img/authorize_step.433601d.640.png",toString:function(){return a.p+"assets/ideal-img/authorize_step.433601d.640.png"},placeholder:void 0,width:640,height:390},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxUlEQVQImUXMS0oDQRhF4dpKpYqIaDekux5/PQg4koTQ6kB0GlcnLsA9KI5Mj12DCBIU5EgawcE3OVyuMtag9Qw901hrJ3NraYzmyBjMX1M5ZZIkaq3/SuGsZFYlsayFUitq4XsWrsfHSJADIZaCF2EZHDn6qavWC/OThuubW56eXxh3O97GVx4f7ikh0PtIFEF1IXF82rDd3rH//uHz4x2+9ozjiJeECxE5DFvvaLuOXCub4YLVMLC5vOJ8vcbFiIthevwFeAxxhna8tG4AAAAASUVORK5CYII=",palette:null}},6342:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/proxy_step.f07be93.640.png 640w,"+a.p+"assets/ideal-img/proxy_step.37f26e1.770.png 770w,"+a.p+"assets/ideal-img/proxy_step.78699f7.900.png 900w,"+a.p+"assets/ideal-img/proxy_step.056fd06.1030.png 1030w",images:[{path:a.p+"assets/ideal-img/proxy_step.f07be93.640.png",width:640,height:340},{path:a.p+"assets/ideal-img/proxy_step.37f26e1.770.png",width:770,height:409},{path:a.p+"assets/ideal-img/proxy_step.78699f7.900.png",width:900,height:479},{path:a.p+"assets/ideal-img/proxy_step.056fd06.1030.png",width:1030,height:548}],src:a.p+"assets/ideal-img/proxy_step.f07be93.640.png",toString:function(){return a.p+"assets/ideal-img/proxy_step.f07be93.640.png"},placeholder:void 0,width:640,height:340},preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmUlEQVQImWWMPQuCUABF/dG9ksZw7Hc0BQ0NBVEOLRFme+TmN0aI5jN9ekKtqQv3LudwNTESjCeC2XyKYRjouo4Q4q8a3/h+gutHBFGCF8REcUJeez+MJqWk7ysjT58UWQqq5F2WFEUxMCmHx6qqWZs2y53Fam+z2Jxxw0f/1DQNbduiddOJx6vDwbpjXhy2pxthkvaiUqqXP/ycrr5S9rLbAAAAAElFTkSuQmCC",palette:null}},1941:function(e,t,a){e.exports={src:{srcSet:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg 640w,"+a.p+"assets/ideal-img/swagger_banner.d480f49.770.jpeg 770w,"+a.p+"assets/ideal-img/swagger_banner.2a80460.900.jpeg 900w,"+a.p+"assets/ideal-img/swagger_banner.85f7c36.1030.jpeg 1030w",images:[{path:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg",width:640,height:285},{path:a.p+"assets/ideal-img/swagger_banner.d480f49.770.jpeg",width:770,height:343},{path:a.p+"assets/ideal-img/swagger_banner.2a80460.900.jpeg",width:900,height:401},{path:a.p+"assets/ideal-img/swagger_banner.85f7c36.1030.jpeg",width:1030,height:458}],src:a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg",toString:function(){return a.p+"assets/ideal-img/swagger_banner.15c9af0.640.jpeg"},placeholder:void 0,width:640,height:285},preSrc:"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAFAAoDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQH/8QAHhAAAQUAAgMAAAAAAAAAAAAAAwABAhESEyEiUaH/xAAVAQEBAAAAAAAAAAAAAAAAAAADBP/EABgRAAIDAAAAAAAAAAAAAAAAAAACAREh/9oADAMBAAIRAxEAPwDbSgKIhSwM0Rcb+DR71d61fylYAc+EeiylLLW/vpEUjTY64f/Z",palette:null}},5429:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return c},contentTitle:function(){return w},metadata:function(){return u},assets:function(){return d},toc:function(){return k},default:function(){return b}});var n=a(7462),p=a(3366),i=(a(7294),a(4137)),o=a(5944),g=a(1941),r=a.n(g),s=a(8268),A=a.n(s),l=a(6342),m=a.n(l),h=["components"],c={slug:"wecom-openapi",title:"\u4f01\u4e1a\u5fae\u4fe1 x Swagger",authors:"rory",tags:["swagger","openapi","wecom","codegen"],keywords:["swagger","openapi","wecom","wxwork","workweixin","workwx","qychat","qywork","openapi3","codegen","wework","wecaht"]},w=void 0,u={permalink:"/zh/wecom-openapi",editUrl:"https://github.com/juzibot/tech-blog/blog/2022-02-18-wecom-openapi.mdx",source:"@site/i18n/zh/docusaurus-plugin-content-blog/2022-02-18-wecom-openapi.mdx",title:"\u4f01\u4e1a\u5fae\u4fe1 x Swagger",description:"\u5728\u6211\u4eec\u5bf9\u63a5\u4f01\u4e1a\u5fae\u4fe1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u4f01\u4e1a\u5fae\u4fe1\u7684 API \u975e\u5e38\u591a\uff0c\u4e14\u53c2\u6570\u5404\u5f02\u3002\u4e3a\u4e86\u6700\u5927\u7a0b\u5ea6\u7684\u51cf\u5c11\u91cd\u590d\u5de5\u4f5c\uff0c\u51cf\u5c11\u7f16\u7801\u4e2d\u7684\u4f4e\u7ea7\u9519\u8bef\uff0c\u6211\u4eec\u51b3\u5b9a\u501f\u52a9\u5de5\u5177\u6765\u81ea\u52a8\u751f\u6210\u4f01\u4e1a\u5fae\u4fe1\u7684 API \u8c03\u7528\u4ee3\u7801\u3002",date:"2022-02-18T00:00:00.000Z",formattedDate:"2022\u5e742\u670818\u65e5",tags:[{label:"swagger",permalink:"/zh/tags/swagger"},{label:"openapi",permalink:"/zh/tags/openapi"},{label:"wecom",permalink:"/zh/tags/wecom"},{label:"codegen",permalink:"/zh/tags/codegen"}],readingTime:4.14,truncated:!0,authors:[{name:"\u5218\u8d35\u7acb",title:"\u53e5\u5b50\u4e92\u52a8\u8d44\u6df1\u5de5\u7a0b\u5e08",url:"https://github.com/gongzili456",imageURL:"https://avatars.githubusercontent.com/u/6082335",key:"rory"}],frontMatter:{slug:"wecom-openapi",title:"\u4f01\u4e1a\u5fae\u4fe1 x Swagger",authors:"rory",tags:["swagger","openapi","wecom","codegen"],keywords:["swagger","openapi","wecom","wxwork","workweixin","workwx","qychat","qywork","openapi3","codegen","wework","wecaht"]},prevItem:{title:"\u4e3a\u4ec0\u4e48\u9762\u8bd5\u8981\u8003\u7b97\u6cd5",permalink:"/zh/algorithm-interview"},nextItem:{title:"\u53e5\u5b50\u4e92\u52a8\u6280\u672f\u535a\u5ba2\u6b63\u5f0f\u4e0a\u7ebf\uff01",permalink:"/zh/first-blog"}},d={authorsImageUrls:[void 0]},k=[{value:"OpenAPI \u89c4\u8303",id:"openapi-\u89c4\u8303",level:2},{value:"WeCom-OpenAPI",id:"wecom-openapi",level:2},{value:"\u4f7f\u7528\u65b9\u5f0f",id:"\u4f7f\u7528\u65b9\u5f0f",level:2},{value:"\u4ee3\u7801\u751f\u6210",id:"\u4ee3\u7801\u751f\u6210",level:2},{value:"Example",id:"example",level:2}],f={toc:k};function b(e){var t=e.components,a=(0,p.Z)(e,h);return(0,i.kt)("wrapper",(0,n.Z)({},f,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"\u5728\u6211\u4eec\u5bf9\u63a5\u4f01\u4e1a\u5fae\u4fe1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u4f01\u4e1a\u5fae\u4fe1\u7684 API \u975e\u5e38\u591a\uff0c\u4e14\u53c2\u6570\u5404\u5f02\u3002\u4e3a\u4e86\u6700\u5927\u7a0b\u5ea6\u7684\u51cf\u5c11\u91cd\u590d\u5de5\u4f5c\uff0c\u51cf\u5c11\u7f16\u7801\u4e2d\u7684\u4f4e\u7ea7\u9519\u8bef\uff0c\u6211\u4eec\u51b3\u5b9a\u501f\u52a9\u5de5\u5177\u6765\u81ea\u52a8\u751f\u6210\u4f01\u4e1a\u5fae\u4fe1\u7684 API \u8c03\u7528\u4ee3\u7801\u3002"),(0,i.kt)("p",null,"\u8fd9\u4e2a\u65f6\u5019\u5c31\u770b\u5230\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"Swagger")," \u8fd9\u4e2a\u9879\u76ee\uff0c\u4e00\u756a\u5c1d\u8bd5\u4e4b\u540e\uff0c\u7adf\u7136\u5f97\u5230\u4e86\u5982\u6b64\u65b9\u4fbf\u597d\u7528\u7684\u4e00\u5957\u5de5\u5177\u2026\u2026"),(0,i.kt)("p",null,"Github: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"github.com/juzibot/wecom-openapi")),(0,i.kt)("p",null,"Demo: ",(0,i.kt)("a",{parentName:"p",href:"https://wecom-openapi.juzibot.com"},"wecom-openapi.juzibot.com")),(0,i.kt)("h2",{id:"openapi-\u89c4\u8303"},"OpenAPI \u89c4\u8303"),(0,i.kt)("p",null,"OpenAPI \u89c4\u8303\uff08OAS\uff09\u5b9a\u4e49\u4e86\u4e00\u4e2a\u6807\u51c6\u7684\u3001\u8bed\u8a00\u65e0\u5173\u7684 RESTful API \u63a5\u53e3\u89c4\u8303\uff0c\u5b83\u53ef\u4ee5\u540c\u65f6\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u548c\u8ba1\u7b97\u673a\u67e5\u770b\u5e76\u7406\u89e3\u67d0\u4e2a\u670d\u52a1\u7684\u529f\u80fd\uff0c\u800c\u65e0\u9700\u8bbf\u95ee\u6e90\u4ee3\u7801\u3001\u6587\u6863\u6216\u7f51\u7edc\u6d41\u91cf\u68c0\u67e5\uff0c\u65e2\u65b9\u4fbf\u4eba\u7c7b\u5b66\u4e60\u548c\u9605\u8bfb\uff0c\u4e5f\u65b9\u4fbf\u673a\u5668\u9605\u8bfb\u3002\u6b63\u786e\u5b9a\u4e49 OAS \u540e\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u6700\u5c11\u7684\u5b9e\u73b0\u903b\u8f91\u6765\u7406\u89e3\u8fdc\u7a0b\u670d\u52a1\u5e76\u4e0e\u4e4b\u4ea4\u4e92\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u6587\u6863\u751f\u6210\u5de5\u5177\u53ef\u4ee5\u4f7f\u7528 OpenAPI \u89c4\u8303\u6765\u751f\u6210 API \u6587\u6863\uff0c\u4ee3\u7801\u751f\u6210\u5de5\u5177\u53ef\u4ee5\u751f\u6210\u5404\u79cd\u7f16\u7a0b\u8bed\u8a00\u4e0b\u7684\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u4ee3\u7801\uff0c\u6d4b\u8bd5\u4ee3\u7801\u548c\u5176\u4ed6\u7528\u4f8b\u3002\u8be6\u89c1\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://swagger.io/specification/"},"OpenAPI Specification")),(0,i.kt)(o.Z,{img:r(),mdxType:"Image"}),(0,i.kt)("h2",{id:"wecom-openapi"},"WeCom-OpenAPI"),(0,i.kt)("p",null,"\u4f01\u4e1a\u5fae\u4fe1\u5e76\u6ca1\u6709\u63d0\u4f9b\u7b26\u5408 OpenAPI \u89c4\u8303\u7684\u6587\u6863\uff0c\u6240\u4ee5 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI")," \u9879\u76ee\u5e94\u8fd0\u800c\u751f\u3002"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI")," \u662f\u5229\u7528  NestJS \u7684 Swagger \u96c6\u6210\u80fd\u529b\u6765\u5b9e\u73b0\u7684\uff0c",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@nestjs/swagger"},"@nestjs/swagger")," \u63d0\u4f9b\u4e86\u4e00\u4e9b\u91cc\u7684\u88c5\u9970\u5668\uff08Decorators\uff09\u6765\u58f0\u660e Swagger \u5c5e\u6027\uff0c\u65b9\u4fbf\u7ba1\u7406 API \u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\u3002"),(0,i.kt)("h2",{id:"\u4f7f\u7528\u65b9\u5f0f"},"\u4f7f\u7528\u65b9\u5f0f"),(0,i.kt)("p",null,"\u628a\u4ee3\u7801\u514b\u9686\u4e0b\u6765\uff0c\u5b89\u88c5\u4f9d\u8d56\u540e\u542f\u52a8\u9879\u76ee\u3002\u542f\u52a8\u540e\u4f1a\u5728\u6839\u76ee\u5f55\u751f\u6210 swagger spec \u6587\u4ef6 openapi.yaml\uff0c\u540c\u65f6\u53ef\u4ee5\u7528\u6d4f\u89c8\u5668\u6253\u5f00 http://localhost:3000/openapi \u67e5\u770b Swagger UI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone git@github.com:juzibot/wecom-openapi.git\n\n$ cd wecom-opwenapi && npm install\n\n$ npm run start\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/juzibot/wecom-openapi"},"WeCom-OpenAPI")," \u63d0\u4f9b\u4e86\u5bf9\u4f01\u4e1a\u5fae\u4fe1 API \u7684\u4ee3\u7406\u8f6c\u53d1\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728 Swagger UI \u4e0a\u76f4\u63a5\u5bf9  API \u8fdb\u884c\u8c03\u8bd5\u3002\u9996\u5148\u5c06\u4f60\u7684 AccessToken \u914d\u7f6e\u597d\u3002"),(0,i.kt)(o.Z,{img:A(),mdxType:"Image"}),(0,i.kt)("p",null,"\u7136\u540e\u9009\u62e9\u672c\u5730\u4ee3\u7406\u5730\u5740\u5373\u53ef\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8de8\u57df\u7684\u95ee\u9898\u3002"),(0,i.kt)(o.Z,{img:m(),mdxType:"Image"}),(0,i.kt)("h2",{id:"\u4ee3\u7801\u751f\u6210"},"\u4ee3\u7801\u751f\u6210"),(0,i.kt)("p",null,"\u4e3b\u6d41\u7684\u4ee3\u7801\u751f\u6210\u5de5\u5177\u662f ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/swagger-api/swagger-codegen"},"swagger-codegen"),"\uff0c\u4f46\u662f\u5b83\u751f\u6210\u7684 golang \u4ee3\u7801\u4e0d\u592a\u53cb\u597d\uff0c\u6240\u4ee5\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/go-swagger/go-swagger"},"go-swagger")," \u9879\u76ee\uff0c\u4f46\u662f\u76ee\u524d\u53ea\u652f\u6301 swagger 2.0 \u7248\u672c\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u4e0a\u9762\u5f97\u5230\u7684  openapi.yaml \u6587\u4ef6\u8f6c\u6362\u6210\u4e00\u4e0b\u7248\u672c\u3002\u8fd9\u91cc\u4f7f\u7528 ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/api-spec-converter"},"api-spec-converter")," \u6765\u505a\u7248\u672c\u8f6c\u6362\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm install -g api-spec-converter\n\n# \u8f6c\u6362\u6587\u6863\u7248\u672c\n$ api-spec-converter --from=openapi_3 --to=swagger_2 \\\n  --syntax=yaml \\\n  --order=alpha \\\n  ./openapi.yaml > swagger.yaml\n \n# \u5b89\u88c5 go-swaager \n$ brew install go-swagger\n \n$ mkdir wecom-api\n\n# \u751f\u6210 golang \u4ee3\u7801\uff0c\u8981\u6c42\u76ee\u6807\u76ee\u5f55\u5fc5\u987b\u5728 GO_PATH \u4e2d\n$ cd wecom-api && go mod init wecom-api\n\n# \u751f\u6210 golang \u4ee3\u7801\n$ swagger generate client -f swagger.yaml -t wecom-api\n")),(0,i.kt)("p",null,"\u81f3\u6b64\uff0c\u5728 wecom-api \u76ee\u5f55\u4e2d\u4f1a\u5f97\u5230\u751f\u6210\u7684\u4ee3\u7801\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./wecom-api/\n\u251c\u2500\u2500 client\n\u2514\u2500\u2500 models\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"client \u76ee\u5f55\u4e2d\u5b58\u653e Client \u5bf9\u8c61\u548c Parameter\u3001Response \u5305\u88c5\u5bf9\u8c61"),(0,i.kt)("li",{parentName:"ul"},"models \u76ee\u5f55\u5b58\u653e Dto\u3001Response \u7684\u5b9e\u4f53\u5b9a\u4e49")),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n  "log"\n  "wecom-api/client"\n  "wecom-api/client/department"\n\n  "github.com/go-openapi/runtime"\n  "github.com/go-openapi/strfmt"\n)\n\n// \u5b9a\u4e49\u9274\u6743\u5bf9\u8c61\ntype auth struct{}\n\nvar token = "token"\n\n// \u5b9e\u73b0 ClientAuthInfoWriter \u63a5\u53e3\nfunc (a *auth) AuthenticateRequest(req runtime.ClientRequest, reg strfmt.Registry) error {\n  // \u5c06 token \u653e\u5728\u6b63\u786e\u7684\u4f4d\u7f6e\n  return req.SetQueryParam("access_token", token)\n}\n\nfunc main() {\n  departmentID := float64(1)\n  params := department.NewListDepartmentParams()\n  params.SetID(&departmentID)\n\n  resp, err := client.Default.Department.ListDepartment(params, &auth{})\n  if err != nil {\n    log.Fatalf("err: %v", err)\n  }\n\n  log.Printf("%v, %s", resp.Payload.Errcode, resp.Payload.Errmsg)\n\n  for _, v := range resp.Payload.Department {\n    log.Printf("%v", v)\n  }\n}\n')))}b.isMDXComponent=!0}}]);